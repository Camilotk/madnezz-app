const xpInicial=1400,precoAtributos={0:0,1:25,2:25,3:50,4:50,5:100,6:100,7:125,8:125,9:150,10:150},precoHabilidades={0:0,1:25,2:25,3:25,4:50,5:50,6:75,7:100,8:100,9:150,10:150,11:175,12:175,13:200,14:200,15:225,16:250,17:250,18:275,19:275,20:300};function createSkillRow(a){const b=document.createElement("div");b.classList.add("skill-row","form-group","mb-3");b.innerHTML=`
        <label for="skill${a}" class="form-label">Habilidade ${a}:</label>
        <input type="text" class="form-control skill-name mb-3" placeholder="Nome da habilidade">
        <input type="number" class="form-control skill-value mb-3" placeholder="N\u00edvel da habilidade" value="0" min="0" max="10">
        <div class="row">
            <div class="col-md-4 d-flex align-items-center">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="passiva${a}" name="passiva${a}" onchange="toggleCheckbox('passiva${a}', 'bonus${a}')">
                    <label class="form-check-label" for="passiva${a}">Passiva</label>
                </div>
            </div>
            <div class="col-md-4 d-flex align-items-center">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="bonus${a}" name="bonus${a}" onchange="toggleCheckbox('bonus${a}', 'passiva${a}')">
                    <label class="form-check-label" for="bonus${a}">Bonus</label>
                </div>
            </div>
        </div>
        <span class="remove-skill text-danger" style="cursor: pointer;">Remover</span>
    `;return b}function toggleCheckbox(a,b){a=document.getElementById(a);b=document.getElementById(b);a.checked&&(b.checked=!1)}function displayAlert(a,b){document.getElementById("alert-container").innerHTML=`
        <div class="alert alert-${b} alert-dismissible fade show mt-5" role="alert">
            <p>Sua ficha tem erros:</p>
            ${a}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    `}function validateForm(){document.getElementById("alert-container").innerHTML="";const a=[];validateBasicInfo(a);validateSkills(a);const b=calcularXP(getAtributos(),getHabilidades()).xpRestante;0<b?a.push(`- Voc\u00ea tem ${b} XP sobrando. Gaste os ${b} restantes.`):0>b&&a.push(`- Voc\u00ea gastou ${Math.abs(b)} XP a mais. Reduza ${Math.abs(b)} do seu gasto.`);return 0<a.length?(displayAlert(a.join("<br>"),"danger"),!1):!0}
function validateBasicInfo(a){const b=document.getElementById("name").value.trim(),c=document.getElementById("group").value,d=document.getElementById("class").value,f=parseInt(document.getElementById("age").value,10)||0,k=document.getElementById("occupation").value,g=document.getElementById("profession").value.trim(),e=document.getElementById("faceclaim").value.trim(),h=window.editor?window.editor.getData().trim():"";b||a.push("- Nome est\u00e1 em branco.");c||a.push("- Voc\u00ea deve selecionar um grupo.");
d||a.push("- Voc\u00ea deve selecionar uma classe.");f||a.push("- Voc\u00ea deve entrar uma idade.");validateAgeByGroup(c,f,a);k||a.push("- Voc\u00ea deve selecionar uma ocupa\u00e7\u00e3o.");g||a.push("- Voc\u00ea deve entrar uma profiss\u00e3o.");e||a.push("- Voc\u00ea deve entrar um faceclaim.");h||a.push("- Voc\u00ea deve entrar uma hist\u00f3ria de personagem.")}
function validateAgeByGroup(a,b,c){(a={Vampiro:1E3,"Bi\u00f3tico":1E3,Parademonio:1E3,Licantropo:300,Sereiano:300,Metamorfo:300,"G\u00f3rgona":200,Feiticeiro:200}[a])&&b>a&&c.push(`- Sua idade \u00e9 alta demais para seu grupo. O m\u00e1ximo \u00e9 ${a} anos.`)}function validateSkills(a){0===getHabilidades().length&&a.push("- Voc\u00ea deve adicionar pelo menos uma habilidade.")}
function getAtributos(){return{FOR:parseInt(document.getElementById("for").value,10)||0,DES:parseInt(document.getElementById("des").value,10)||0,PRE:parseInt(document.getElementById("pre").value,10)||0,MEN:parseInt(document.getElementById("men").value,10)||0,ALM:parseInt(document.getElementById("alm").value,10)||0,CON:parseInt(document.getElementById("con").value,10)||0,REF:parseInt(document.getElementById("ref").value,10)||0,GUA:parseInt(document.getElementById("gua").value,10)||0,AUR:parseInt(document.getElementById("aur").value,
10)||0,BIO:parseInt(document.getElementById("bio").value,10)||0}}function getHabilidades(){const a=document.getElementById("skills-container").getElementsByClassName("skill-row"),b=[];Array.from(a).forEach((c,d)=>{processSkillRow(c,d+1,b)});return b}
function processSkillRow(a,b,c){const d=a.querySelector(".skill-name").value.trim(),f=parseInt(a.querySelector(".skill-value").value,10)||0,k=a.querySelector(`#passiva${b}`).checked;a=a.querySelector(`#bonus${b}`).checked;d&&c.push({nome:d,valor:f,passiva:k,bonus:a})}function calcularXP(a,b){const c=calcularCusto(a,precoAtributos),d=calcularCustoHabilidades(b),f=c+d;return{atributos:a,habilidades:b,custoTotalAtributos:c,custoTotalHabilidades:d,custoTotalXP:f,xpRestante:xpInicial-f}}
function calcularCusto(a,b){return Array.isArray(a)?a.reduce((c,d)=>c+calcularCustoAtributo(d,b),0):Object.values(a).reduce((c,d)=>c+calcularCustoAtributo(d,b),0)}function calcularCustoAtributo(a,b){let c=0;for(let d=1;d<=a;d++)c+=b[d]||0;return c}function calcularCustoHabilidades(a){return a.reduce((b,{valor:c,passiva:d,bonus:f})=>d?b+25:f&&4>=c?b:b+calcularCustoAtributo(c,precoHabilidades),0)}
function gerarFicha(a,b,c,d,f,k,g,e,h,l,m){h=h.map(({nome:n,valor:p,passiva:q,bonus:r})=>q?`<b>${n} \u2014</b> passiva<br>`:r&&4>=p?`<b>${n} \u2014</b> 4<br>`:`<b>${n} \u2014</b> ${p}<br>`).join("");return`[dohtml]<style>.one {width: 95%; background-color: #333;}</style>
<div id="holdapp">
    <div class="holdapptop">
        <div class="color"></div>
        <div class="holdinsideapp">
            <div class="tituloapp"><strong>${a}</strong><br><br>
                <div class="jarzietext">
                    <center>
                        <table>
                            <tr>
                                <td>
                                    <div class="appabilities">Grupo</div>
                                    <div class="appskillscontainer">
                                        <div class="appskills one">${b}</div>
                                    </div>
                                    <p>
                                    <div class="appabilities">Classe</div>
                                    <div class="appskillscontainer">
                                        <div class="appskills one">${c}</div>
                                    </div>
                                    <p>
                                    <div class="appabilities">Idade</div>
                                    <div class="appskillscontainer">
                                        <div class="appskills one">${d} anos</div>
                                    </div>
                                    <p>
                                    <div class="appabilities">Ocupa\u00e7\u00e3o</div>
                                    <div class="appskillscontainer">
                                        <div class="appskills one">${f}</div>
                                    </div>
                                    <p>
                                    <div class="appabilities">Profiss\u00e3o</div>
                                    <div class="appskillscontainer">
                                        <div class="appskills one">${k}</div>
                                    </div>
                                    <p>
                                    <div class="appabilities">Faceclaim</div>
                                    <div class="appskillscontainer">
                                        <div class="appskills one">${g}</div>
                                    </div>
                                </td>
                                <td>
                                    <img src="${m||"https://via.placeholder.com/200x320"}" class="mad_imagem">
                                </td>
                            </tr>
                        </table>
                    </center>
                </div>
                <p><p>
                <div class="tituloapp2"><strong>Hist\u00f3ria</strong></div>
                <div class="jarzietext">${l}</div>
                <p><p>
                <div class="tituloapp2"><strong>Atributos</strong></div>
                <div class="jarzietext">
                    <center>
                        <table style="padding: 20px 30px;">
                            <tr>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${e.FOR}</div><p><p> FOR </td>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${e.DES}</div><p><p> DES </td>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${e.PRE}</div><p><p> PRE </td>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${e.MEN}</div><p><p> MEN </td>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${e.ALM}</div><p><p> ALM </td>
                            </tr>
                        </table>
                        <table>
                            <tr>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${e.CON}</div><p><p> CON </td>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${e.REF}</div><p><p> REF </td>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${e.GUA}</div><p><p> GUA </td>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${e.AUR}</div><p><p> AUR </td>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${e.BIO}</div><p><p> BIO </td>
                            </tr>
                        </table>
                    </center>
                </div>
                <p><p>
                <div class="tituloapp2"><strong>Habilidades</strong></div>
                <div class="jarzietext"><b>Habilidade de Grupo</b><br>${h}</div>
                <p><p>
            </div>
        </div>
    </div>
</div>
[/dohtml]`}function transformarString(a){return{"Bi\u00f3ticos":"biotico","Ca\u00e7ador":"cacador",Ciborgue:"ciborgue",Feiticeiro:"feiticeiro","G\u00f3rgonas":"gorgona",Metamorfos:"metamorfo",Licantropos:"licantropo",Sereianos:"sereiano",Vampiros:"vampiro","Dem\u00f4nio":"demonio","Paradem\u00f4nio":"parademonio"}[a]||a}
function gerarPPCode(a,b,c){return`[CODE]<b><${transformarString(c)||"grupo"}>${b.toUpperCase()||"NOME DO PHOTOPLAYER"}</${transformarString(c)||"grupo"}></b><br> ${a||"Nome Personagem"}<br>[/CODE]`}function getImageLink(){const a=document.getElementById("imageLink").value;return document.getElementById("imageFrame").src=a}function gerarOCCode(a,b,c){return`${a||"Nome do Personagem"}: ${b||"Grupo"}, ${c||"Ocupa\u00e7\u00e3o"}.`}
document.addEventListener("DOMContentLoaded",()=>{$("#group, #class, #occupation").select2({placeholder:"Selecione uma op\u00e7\u00e3o",allowClear:!0});document.getElementById("add-skill").addEventListener("click",()=>{const a=document.getElementById("skills-container"),b=a.getElementsByClassName("skill-row").length+1,c=createSkillRow(b);a.appendChild(c);c.querySelector(".remove-skill").addEventListener("click",()=>{a.removeChild(c)})});document.getElementById("sendImg").addEventListener("click",
()=>getImageLink());document.getElementById("generate").addEventListener("click",()=>{document.getElementById("generated-code").classList.remove("border-danger");validateForm()||document.getElementById("generated-code").classList.add("border-danger");var a=document.getElementById("name").value;const b=document.getElementById("group").value;var c=document.getElementById("class").value;const d=parseInt(document.getElementById("age").value,10)||0,f=document.getElementById("occupation").value,k=document.getElementById("profession").value;
var g=document.getElementById("faceclaim").value,e=getAtributos();const h=getHabilidades(),l=window.editor.getData(),m=getImageLink();c=gerarFicha(a,b,c,d,f,k,g,e,h,l,m);document.getElementById("generated-code").textContent=c;g=gerarPPCode(a,g,b);document.getElementById("photoplayerRegistry").placeholder=g;a=gerarOCCode(a,b,f);document.getElementById("occupationRegistry").placeholder=a;e=JSON.stringify(calcularXP(e,h),null,2);document.getElementById("xp-json").textContent=e});["copy-generated","copy-xp",
"copy-pp","copy-oc"].forEach(a=>{document.getElementById(a).addEventListener("click",()=>{var b=a.replace("copy-","");b=document.getElementById(b);navigator.clipboard.writeText(b.textContent||b.placeholder).then(()=>{alert("Copiado para a \u00e1rea de transfer\u00eancia!")})})})});
