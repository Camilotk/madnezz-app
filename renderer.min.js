const xpInicial=1400,precoAtributos={0:0,1:25,2:25,3:50,4:50,5:100,6:100,7:125,8:125,9:150,10:150},precoHabilidades={0:0,1:25,2:25,3:25,4:50,5:50,6:75,7:100,8:100,9:150,10:150,11:175,12:175,13:200,14:200,15:225,16:250,17:250,18:275,19:275,20:300};function createSkillRow(a){const b=document.createElement("div");b.classList.add("skill-row","form-group","mb-3");b.innerHTML=`
        <label for="skill${a}" class="form-label">Habilidade ${a}:</label>
        <input type="text" class="form-control skill-name mb-3" placeholder="Nome da habilidade">
        <input type="number" class="form-control skill-value mb-3" placeholder="N\u00edvel da habilidade" value="0" min="0" max="10">
        <div class="row">
            <div class="col-md-4 d-flex align-items-center">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="passiva${a}" name="passiva${a}" onchange="toggleCheckbox('passiva${a}', 'bonus${a}')">
                    <label class="form-check-label" for="passiva${a}">Passiva</label>
                </div>
            </div>
            <div class="col-md-4 d-flex align-items-center">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="bonus${a}" name="bonus${a}" onchange="toggleCheckbox('bonus${a}', 'passiva${a}')">
                    <label class="form-check-label" for="bonus${a}">Bonus</label>
                </div>
            </div>
        </div>
        <span class="remove-skill text-danger" style="cursor: pointer;">Remover</span>
    `;return b}function toggleCheckbox(a,b){a=document.getElementById(a);b=document.getElementById(b);a.checked&&(b.checked=!1)}function displayAlert(a,b){document.getElementById("alert-container").innerHTML=`
        <div class="alert alert-${b} mt-5" role="alert">
            <p>Sua ficha tem erros:</p>
            ${a}
        </div>
    `}function validateForm(){document.getElementById("alert-container").innerHTML="";const a=[];validateBasicInfo(a);validateSkills(a);const b=calcularXP(getAtributos(),getHabilidades()).xpRestante;0<b?a.push(`- Voc\u00ea tem ${b} XP sobrando. Gaste os ${b} restantes.`):0>b&&a.push(`- Voc\u00ea gastou ${Math.abs(b)} XP a mais. Reduza ${Math.abs(b)} do seu gasto.`);return 0<a.length?(displayAlert(a.join("<br>"),"danger"),!1):!0}
function validateBasicInfo(a){const b=document.getElementById("name").value.trim(),d=document.getElementById("group").value,c=document.getElementById("class").value,e=parseInt(document.getElementById("age").value,10)||0,k=document.getElementById("occupation").value,g=document.getElementById("profession").value.trim(),f=document.getElementById("faceclaim").value.trim(),h=window.editor?window.editor.getData().trim():"";b||a.push("- Nome est\u00e1 em branco.");d||a.push("- Voc\u00ea deve selecionar um grupo.");
c||a.push("- Voc\u00ea deve selecionar uma classe.");e||a.push("- Voc\u00ea deve entrar uma idade.");validateAgeByGroup(d,e,a);k||a.push("- Voc\u00ea deve selecionar uma ocupa\u00e7\u00e3o.");g||a.push("- Voc\u00ea deve entrar uma profiss\u00e3o.");f||a.push("- Voc\u00ea deve entrar um faceclaim.");h||a.push("- Voc\u00ea deve entrar uma hist\u00f3ria de personagem.")}
function validateAgeByGroup(a,b,d){(a={Vampiro:1E3,"Bi\u00f3tico":1E3,Parademonio:1E3,Licantropo:300,Sereiano:300,Metamorfo:300,"G\u00f3rgona":200,Feiticeiro:200}[a])&&b>a&&d.push(`- Sua idade \u00e9 alta demais para seu grupo. O m\u00e1ximo \u00e9 ${a} anos.`)}function validateSkills(a){0===getHabilidades().length&&a.push("- Voc\u00ea deve adicionar pelo menos uma habilidade.")}
function getAtributos(){return{FOR:parseInt(document.getElementById("for").value,10)||0,DES:parseInt(document.getElementById("des").value,10)||0,PRE:parseInt(document.getElementById("pre").value,10)||0,MEN:parseInt(document.getElementById("men").value,10)||0,ALM:parseInt(document.getElementById("alm").value,10)||0,CON:parseInt(document.getElementById("con").value,10)||0,REF:parseInt(document.getElementById("ref").value,10)||0,GUA:parseInt(document.getElementById("gua").value,10)||0,AUR:parseInt(document.getElementById("aur").value,
10)||0,BIO:parseInt(document.getElementById("bio").value,10)||0}}function getHabilidades(){const a=document.getElementById("skills-container").getElementsByClassName("skill-row"),b=[];Array.from(a).forEach((d,c)=>{processSkillRow(d,c+1,b)});return b}
function processSkillRow(a,b,d){const c=a.querySelector(".skill-name").value.trim(),e=parseInt(a.querySelector(".skill-value").value,10)||0,k=a.querySelector(`#passiva${b}`).checked;a=a.querySelector(`#bonus${b}`).checked;c&&d.push({nome:c,valor:e,passiva:k,bonus:a})}function calcularXP(a,b){const d=calcularCusto(a,precoAtributos),c=calcularCustoHabilidades(b),e=d+c;return{atributos:a,habilidades:b,custoTotalAtributos:d,custoTotalHabilidades:c,custoTotalXP:e,xpRestante:xpInicial-e}}
function calcularCusto(a,b){return Array.isArray(a)?a.reduce((d,c)=>d+calcularCustoAtributo(c,b),0):Object.values(a).reduce((d,c)=>d+calcularCustoAtributo(c,b),0)}function calcularCustoAtributo(a,b){let d=0;for(let c=1;c<=a;c++)d+=b[c]||0;return d}function calcularCustoHabilidades(a){return a.reduce((b,{valor:d,passiva:c,bonus:e})=>c?b+25:e&&4>=d?b:b+calcularCustoAtributo(d,precoHabilidades),0)}
function gerarFicha(a,b,d,c,e,k,g,f,h,n,p){h=h.map(({nome:l,valor:m,passiva:r,bonus:q})=>r?`<b>${l} \u2014</b> passiva<br>`:q&&4>=m?`<b>${l} \u2014</b> 4 (b\u00f4nus)<br>`:q&&4<=m?`<b>${l} \u2014</b> ${m} (b\u00f4nus)<br>`:`<b>${l} \u2014</b> ${m}<br>`).join("");return`[dohtml]<style>.one {width: 95%; background-color: #333;}</style>
<div id="holdapp">
    <div class="holdapptop">
        <div class="color"></div>
        <div class="holdinsideapp">
            <div class="tituloapp"><strong>${a}</strong><br><br>
                <div class="jarzietext">
                    <center>
                        <table>
                            <tr>
                                <td>
                                    <div class="appabilities">Grupo</div>
                                    <div class="appskillscontainer">
                                        <div class="appskills one">${b}</div>
                                    </div>
                                    <p>
                                    <div class="appabilities">Classe</div>
                                    <div class="appskillscontainer">
                                        <div class="appskills one">${d}</div>
                                    </div>
                                    <p>
                                    <div class="appabilities">Idade</div>
                                    <div class="appskillscontainer">
                                        <div class="appskills one">${c} anos</div>
                                    </div>
                                    <p>
                                    <div class="appabilities">Ocupa\u00e7\u00e3o</div>
                                    <div class="appskillscontainer">
                                        <div class="appskills one">${e}</div>
                                    </div>
                                    <p>
                                    <div class="appabilities">Profiss\u00e3o</div>
                                    <div class="appskillscontainer">
                                        <div class="appskills one">${k}</div>
                                    </div>
                                    <p>
                                    <div class="appabilities">Faceclaim</div>
                                    <div class="appskillscontainer">
                                        <div class="appskills one">${g}</div>
                                    </div>
                                </td>
                                <td>
                                    <img src="${p||"https://via.placeholder.com/200x320"}" class="mad_imagem">
                                </td>
                            </tr>
                        </table>
                    </center>
                </div>
                <p><p>
                <div class="tituloapp2"><strong>Hist\u00f3ria</strong></div>
                <div class="jarzietext">${n}</div>
                <p><p>
                <div class="tituloapp2"><strong>Atributos</strong></div>
                <div class="jarzietext">
                    <center>
                        <table style="padding: 20px 30px;">
                            <tr>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${f.FOR}</div><p><p> FOR </td>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${f.DES}</div><p><p> DES </td>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${f.PRE}</div><p><p> PRE </td>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${f.MEN}</div><p><p> MEN </td>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${f.ALM}</div><p><p> ALM </td>
                            </tr>
                        </table>
                        <table>
                            <tr>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${f.CON}</div><p><p> CON </td>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${f.REF}</div><p><p> REF </td>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${f.GUA}</div><p><p> GUA </td>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${f.AUR}</div><p><p> AUR </td>
                                <td style="padding: 20px 30px;"><div class="subtituloappi">${f.BIO}</div><p><p> BIO </td>
                            </tr>
                        </table>
                    </center>
                </div>
                <p><p>
                <div class="tituloapp2"><strong>Habilidades</strong></div>
                <div class="jarzietext"><b>Habilidade de Grupo</b><br>${h}</div>
                <p><p>
            </div>
        </div>
    </div>
</div>
[/dohtml]`}function transformarString(a){return{"Bi\u00f3ticos":"biotico","Ca\u00e7ador":"cacador",Ciborgue:"ciborgue",Feiticeiro:"feiticeiro","G\u00f3rgona":"gorgona",Metamorfo:"metamorfo",Licantropo:"licantropo",Sereiano:"sereiano",Vampiro:"vampiro","Paradem\u00f4nio":"parademonio"}[a]||a}function gerarPPCode(a,b,d){return`[CODE]<b><${transformarString(d)||"grupo"}>${b.toUpperCase()||"NOME DO PHOTOPLAYER"}</${transformarString(d)||"grupo"}></b><br> ${a||"Nome Personagem"}<br>[/CODE]`}
function getImageLink(){const a=document.getElementById("imageLink").value;return document.getElementById("imageFrame").src=a}function gerarOCCode(a,b,d){return`${a||"Nome do Personagem"}: ${b||"Grupo"}, ${d||"Ocupa\u00e7\u00e3o"}.`}
document.addEventListener("DOMContentLoaded",()=>{$("#group, #class, #occupation").select2({placeholder:"Selecione uma op\u00e7\u00e3o",allowClear:!0});document.getElementById("add-skill").addEventListener("click",()=>{const a=document.getElementById("skills-container"),b=a.getElementsByClassName("skill-row").length+1,d=createSkillRow(b);a.appendChild(d);d.querySelector(".remove-skill").addEventListener("click",()=>{a.removeChild(d)})});document.getElementById("sendImg").addEventListener("click",
()=>getImageLink());document.getElementById("generate").addEventListener("click",()=>{document.getElementById("generated-code").classList.remove("border-danger");validateForm()||document.getElementById("generated-code").classList.add("border-danger");var a=document.getElementById("name").value;const b=document.getElementById("group").value;var d=document.getElementById("class").value;const c=parseInt(document.getElementById("age").value,10)||0,e=document.getElementById("occupation").value,k=document.getElementById("profession").value;
var g=document.getElementById("faceclaim").value,f=getAtributos();const h=getHabilidades(),n=window.editor.getData(),p=getImageLink();d=gerarFicha(a,b,d,c,e,k,g,f,h,n,p);document.getElementById("generated-code").textContent=d;g=gerarPPCode(a,g,b);document.getElementById("photoplayerRegistry").placeholder=g;a=gerarOCCode(a,b,e);document.getElementById("occupationRegistry").placeholder=a;f=JSON.stringify(calcularXP(f,h),null,2);document.getElementById("xp-json").textContent=f});document.getElementById("copy-generated").addEventListener("click",
()=>{const a=document.getElementById("generated-code");navigator.clipboard.writeText(a.textContent).then(()=>{alert("Ficha copiada para a \u00e1rea de transfer\u00eancia!")})});document.getElementById("copy-pp").addEventListener("click",()=>{var a=document.getElementById("photoplayerRegistry");a=decodeURIComponent(a.placeholder);navigator.clipboard.writeText(a).then(()=>{alert("Photoplayer copiado para a \u00e1rea de transfer\u00eancia!")})});document.getElementById("copy-oc").addEventListener("click",
()=>{const a=`${document.getElementById("occupationRegistry").getAttribute("placeholder")}`;navigator.clipboard.writeText(a).then(()=>{alert("Ocupa\u00e7\u00e3o copiado para a \u00e1rea de transfer\u00eancia!")}).catch(b=>{console.error("Erro ao copiar o texto: ",b)});console.log(a)});document.getElementById("export").addEventListener("click",()=>exportToJSON())});
function exportToJSON(){var a={name:document.getElementById("name").value,group:document.getElementById("group").value,class:document.getElementById("class").value,age:document.getElementById("age").value,occupation:document.getElementById("occupation").value,profession:document.getElementById("profession").value,faceclaim:document.getElementById("faceclaim").value,imageLink:document.getElementById("imageLink").value,history:window.editor?window.editor.getData():document.getElementById("history").value,
attributes:{for:document.getElementById("for").value,des:document.getElementById("des").value,pre:document.getElementById("pre").value,men:document.getElementById("men").value,alm:document.getElementById("alm").value,con:document.getElementById("con").value,ref:document.getElementById("ref").value,gua:document.getElementById("gua").value,aur:document.getElementById("aur").value,bio:document.getElementById("bio").value},skills:Array.from(document.querySelectorAll(".skill-row")).map((d,c)=>{const e=
document.querySelector(`#passiva${c+1}`);c=document.querySelector(`#bonus${c+1}`);return{name:d.querySelector(".skill-name").value,value:d.querySelector(".skill-value").value,passiva:e?e.checked:!1,bonus:c?c.checked:!1}})};a=new Blob([JSON.stringify(a,null,2)],{type:"application/json"});a=URL.createObjectURL(a);const b=document.createElement("a");b.href=a;b.download="character-sheet.json";b.click();URL.revokeObjectURL(a)}
function importFromJSON(a){if(a){var b=new FileReader;b.onload=function(d){try{const c=JSON.parse(d.target.result);document.querySelector("#name").value=c.name||"";$("#group").val(c.group||"").trigger("change");$("#class").val(c.class||"").trigger("change");document.querySelector("#age").value=c.age||"";$("#occupation").val(c.occupation||"").trigger("change");document.querySelector("#profession").value=c.profession||"";document.querySelector("#faceclaim").value=c.faceclaim||"";document.querySelector("#imageLink").value=
c.imageLink||"";document.getElementById("imageFrame").src=JSON.parse(d.target.result).imageLink||"https://via.placeholder.com/200x320";window.editor?window.editor.setData(c.history||""):document.querySelector("#history").value=c.history||"";const e=c.attributes||{};document.querySelector("#for").value=e.for||"1";document.querySelector("#des").value=e.des||"1";document.querySelector("#pre").value=e.pre||"1";document.querySelector("#men").value=e.men||"1";document.querySelector("#alm").value=e.alm||
"1";document.querySelector("#con").value=e.con||"1";document.querySelector("#ref").value=e.ref||"1";document.querySelector("#gua").value=e.gua||"1";document.querySelector("#aur").value=e.aur||"1";document.querySelector("#bio").value=e.bio||"1";const k=document.querySelector("#skills-container");k.innerHTML="";Array.isArray(c.skills)&&c.skills.forEach((g,f)=>{const h=document.createElement("div");h.className="skill-row form-group mb-3";h.innerHTML=`
                <label for="skill${f+1}" class="form-label">Habilidade ${f+1}:</label>
                <input type="text" class="form-control skill-name mb-3" placeholder="Nome da habilidade" value="${g.name||""}">
                <input type="number" class="form-control skill-value mb-3" placeholder="N\u00edvel da habilidade" value="${g.value||0}" min="0" max="10">
                <div class="row">
                    <div class="col-md-4 d-flex align-items-center">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="passiva${f+1}" name="passiva${f+1}" ${g.passiva?"checked":""}>
                            <label class="form-check-label" for="passiva${f+1}">Passiva</label>
                        </div>
                    </div>
                    <div class="col-md-4 d-flex align-items-center">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="bonus${f+1}" name="bonus${f+1}" ${g.bonus?"checked":""}>
                            <label class="form-check-label" for="bonus${f+1}">Bonus</label>
                        </div>
                    </div>
                </div>
                <span class="remove-skill text-danger" style="cursor: pointer;">Remover</span>
            `;k.appendChild(h)})}catch(c){console.error("Erro ao ler o arquivo JSON:",c),alert("Erro ao processar o arquivo JSON.")}};b.readAsText(a);alert("Importado com sucesso")}}document.querySelector("#import").addEventListener("click",function(){const a=document.querySelector("#importFile");0<a.files.length?importFromJSON(a.files[0]):alert("Nenhum arquivo selecionado para importar.")});
