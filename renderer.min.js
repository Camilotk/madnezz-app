document.getElementById("add-skill").addEventListener("click",()=>{const a=document.getElementById("skills-container"),b=a.getElementsByClassName("skill-row").length+1,c=document.createElement("div");c.classList.add("skill-row","form-group","mb-3");c.innerHTML=`
        <label for="skill${b}" class="form-label">Habilidade ${b}:</label>
        <input type="text" class="form-control skill-name mb-3" placeholder="Nome da habilidade">
        <input type="number" class="form-control skill-value mb-3" placeholder="N\u00edvel da habilidade" value="0" min="0" max="10">
        
        <div class="row">
            <div class="col-md-4 d-flex align-items-center">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="passiva${b}" name="passiva${b}" onchange="toggleCheckbox('passiva${b}', 'bonus${b}')">
                    <label class="form-check-label" for="passiva${b}">Passiva</label>
                </div>
            </div>

            <div class="col-md-4 d-flex align-items-center">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="bonus${b}" name="bonus${b}" onchange="toggleCheckbox('bonus${b}', 'passiva${b}')">
                    <label class="form-check-label" for="bonus${b}">Bonus</label>
                </div>
            </div>
        </div>
        
        <span class="remove-skill text-danger" style="cursor: pointer;">Remover</span>
    `;a.appendChild(c);c.querySelector(".remove-skill").addEventListener("click",()=>{a.removeChild(c)})});function toggleCheckbox(a,b){a=document.getElementById(a);b=document.getElementById(b);a.checked&&(b.checked=!1)}function displayAlert(a,b){document.getElementById("alert-container").innerHTML=`<div class="alert alert-${b} alert-dismissible fade show mt-5" role="alert">
            <p>Sua ficha tem erros:</p>
            ${a}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>`}
function validateForm(){document.getElementById("alert-container").innerHTML="";const a=[];var b=document.getElementById("name").value.trim(),c=document.getElementById("group").value,d=document.getElementById("class").value;const e=parseInt(document.getElementById("age").value)||0,g=document.getElementById("occupation").value,h=document.getElementById("profession").value.trim(),f=document.getElementById("faceclaim").value.trim(),k=window.editor.getData().trim();b||a.push("- Nome est\u00e1 em branco.");c||
a.push("- Voc\u00ea deve selecionar um grupo.");d||a.push("- Voc\u00ea deve selecionar uma classe.");e||a.push("- Voc\u00ea deve entrar uma idade.");["Vampiro","Bi\u00f3tico","Parademonio"].includes(c)&&1E3<e&&a.push("- Sua idade \u00e9 alta demais para seu grupo. O m\u00e1ximo \u00e9 1000 anos.");["Licantropo","Sereiano","Metamorfo"].includes(c)&&300<e&&a.push("- Sua idade \u00e9 alta demais para seu grupo. O m\u00e1ximo \u00e9 300 anos.");["G\u00f3rgona","Feiticeiro"].includes(c)&&200<e&&a.push("- Sua idade \u00e9 alta demais para seu grupo. O m\u00e1ximo \u00e9 200 anos.");
g||a.push("- Voc\u00ea deve selecionar uma ocupa\u00e7\u00e3o.");h||a.push("- Voc\u00ea deve entrar uma profiss\u00e3o.");f||a.push("- Voc\u00ea deve entrar um faceclaim.");k||a.push("- Voc\u00ea deve entrar uma hist\u00f3ria de personagem.");b=document.getElementById("skills-container").getElementsByClassName("skill-row");c=[];for(d=0;d<b.length;d++)processSkillRow(b[d],d+1,c);b=calcularXP({FOR:parseInt(document.getElementById("for").value)||0,DES:parseInt(document.getElementById("des").value)||
0,PRE:parseInt(document.getElementById("pre").value)||0,MEN:parseInt(document.getElementById("men").value)||0,ALM:parseInt(document.getElementById("alm").value)||0,CON:parseInt(document.getElementById("con").value)||0,REF:parseInt(document.getElementById("ref").value)||0,GUA:parseInt(document.getElementById("gua").value)||0,AUR:parseInt(document.getElementById("aur").value)||0,BIO:parseInt(document.getElementById("bio").value)||0},c).xpRestante;0<b?a.push(`- Voc\u00ea tem ${b} XP sobrando, o XP tem que ser 0. Gaste os ${b} restantes.`):
0>b&&a.push(`- Voc\u00ea gastou ${Math.abs(b)} XP a mais, o XP tem que ser 0. Reduza ${Math.abs(b)} do seu gasto`);return 0<a.length?(displayAlert(a.join("<br>"),"danger"),!1):!0}
document.getElementById("generate").addEventListener("click",()=>{validateForm();var a=document.getElementById("name").value;const b=document.getElementById("group").value;var c=document.getElementById("class").value;const d=document.getElementById("age").value,e=document.getElementById("occupation").value,g=document.getElementById("profession").value;var h=document.getElementById("faceclaim").value,f={FOR:parseInt(document.getElementById("for").value)||0,DES:parseInt(document.getElementById("des").value)||
0,PRE:parseInt(document.getElementById("pre").value)||0,MEN:parseInt(document.getElementById("men").value)||0,ALM:parseInt(document.getElementById("alm").value)||0,CON:parseInt(document.getElementById("con").value)||0,REF:parseInt(document.getElementById("ref").value)||0,GUA:parseInt(document.getElementById("gua").value)||0,AUR:parseInt(document.getElementById("aur").value)||0,BIO:parseInt(document.getElementById("bio").value)||0},k=document.getElementById("skills-container").getElementsByClassName("skill-row");
const m=[];for(var l=0;l<k.length;l++)processSkillRow(k[l],l+1,m);k=window.editor.getData();l=getImageLink();c=gerarFicha(a,b,c,d,e,g,h,f,m,k,l);document.getElementById("generated-code").textContent=c;h=gerarPPCode(a,h,b);document.getElementById("photoplayerRegistry").placeholder=h;a=gerarOCCode(a,b,e);document.getElementById("occupationRegistry").placeholder=a;f=JSON.stringify(calcularXP(f,m),null,2);document.getElementById("xp-json").textContent=f});
function transformarString(a){return{"Bi\u00f3ticos":"biotico","Ca\u00e7ador":"cacador",Ciborgue:"ciborgue",Feiticeiro:"feiticeiro","G\u00f3rgonas":"gorgona",Metamorfos:"metamorfo",Licantropos:"licantropo",Sereianos:"sereiano",Vampiros:"vampiro","Dem\u00f4nio":"demonio","Paradem\u00f4nio":"parademonio"}[a]||a}
function processSkillRow(a,b,c){const d=a.querySelector(".skill-name").value.trim(),e=parseInt(a.querySelector(".skill-value").value)||0;var g=a.querySelector(`#passiva${b}`);a=a.querySelector(`#bonus${b}`);g=g.checked;a=a.checked;d&&c.push({nome:d,valor:e,passiva:g,bonus:a})}function gerarPPCode(a,b,c){return`[CODE]<b><${transformarString(c)||"grupo"}>${b.toUpperCase()||"NOME DO PHOTOPLAYER"}</${transformarString(c)||"grupo"}></b><br> ${a||"Nome Personagem"}<br>[/CODE]`}
function gerarOCCode(a,b,c){return`${a||"Nome do Personagem"}: ${b||"Grupo"}, ${c||"Ocupa\u00e7\u00e3o"}.`}function getImageLink(){const a=document.getElementById("imageLink").value;return document.getElementById("imageFrame").src=a}document.getElementById("sendImg").addEventListener("click",a=>{a.preventDefault();getImageLink()});
document.getElementById("copy-generated").addEventListener("click",()=>{const a=document.getElementById("generated-code");navigator.clipboard.writeText(a.textContent).then(()=>{alert("Ficha copiada para a \u00e1rea de transfer\u00eancia!")})});document.getElementById("copy-xp").addEventListener("click",()=>{const a=document.getElementById("xp-json");navigator.clipboard.writeText(a.textContent).then(()=>{alert("Resultado do XP copiado para a \u00e1rea de transfer\u00eancia!")})});
document.getElementById("copy-pp").addEventListener("click",()=>{const a=document.getElementById("photoplayerRegistry");navigator.clipboard.writeText(a.placeholder).then(()=>{alert("Photoplayer copiado para a \u00e1rea de transfer\u00eancia!")})});document.getElementById("copy-oc").addEventListener("click",()=>{const a=document.getElementById("occupationRegistry");navigator.clipboard.writeText(a.placeholder).then(()=>{alert("Ocupa\u00e7\u00e3o copiado para a \u00e1rea de transfer\u00eancia!")})});
const xp_inicial=1400,preco_atributos={0:0,1:25,2:25,3:50,4:50,5:100,6:100,7:125,8:125,9:150,10:150},preco_habilidades={0:0,1:25,2:25,3:25,4:50,5:50,6:75,7:100,8:100,9:150,10:150,11:175,12:175,13:200,14:200,15:225,16:250,17:250,18:275,19:275,20:300};function calcularXP(a,b){const c=calcularCustoAtributos(a),d=calcularCustoHabilidades(b),e=c+d;return{atributos:a,habilidades:b,custoTotalAtributos:c,custoTotalHabilidades:d,custoTotalXP:e,xpRestante:xp_inicial-e}}
function calcularCustoAtributos(a){return Object.values(a).reduce((b,c)=>{let d=0;for(let e=1;e<=c;e++)d+=preco_atributos[e]||0;return b+d},0)}function calcularCustoHabilidades(a){return a.reduce((b,c)=>{let d=0;const {valor:e,passiva:g,bonus:h}=c;if(g)d=25;else if(h)if(4>=e)d=0;else for(c=5;c<=e;c++)d+=preco_habilidades[c]||0;else for(c=1;c<=e;c++)d+=preco_habilidades[c]||0;return b+d},0)}
function gerarFicha(a,b,c,d,e,g,h,f,k,m,l){let n="";k.forEach(({nome:p,valor:q,passiva:r,bonus:t})=>{n=r?n+`<b>${p} \u2014</b> passiva<br>`:t&&4>=q?n+`<b>${p} \u2014</b> 4<br>`:n+`<b>${p} \u2014</b> ${q}<br>`});return`[dohtml]<style>.one {width: 95%; background-color: #333;}</style>
<div id="holdapp">
<div class="holdapptop">
<div class="color"></div>
<div class="holdinsideapp"><div class="tituloapp"><strong>${a}</strong><br><br>
<div class="jarzietext">
<center> <table><tr>

<td>    
<div class="appabilities">Grupo</div>
<div class="appskillscontainer">
<div class="appskills one">${b}</div>
</div>
<p>

<div class="appabilities">Classe</div>
<div class="appskillscontainer">
<div class="appskills one">${c}</div>
</div>
<p>

<div class="appabilities">Idade</div>
<div class="appskillscontainer">
<div class="appskills one">${d} anos</div>
</div>
<p>

<div class="appabilities">Ocupa\u00e7\u00e3o</div>
<div class="appskillscontainer">
<div class="appskills one">${e}</div>
</div>
<p>

<div class="appabilities">Profiss\u00e3o</div>
<div class="appskillscontainer">
<div class="appskills one">${g}</div>
</div>
<p>

<div class="appabilities">Faceclaim</div>
<div class="appskillscontainer">
<div class="appskills one">${h}</div>
</div>
</td><td><img src="${l||"https://via.placeholder.com/200x320"}" class="mad_imagem"></td>

</tr></table></center></div><p><p>

<div class="tituloapp2"><strong>Hist\u00f3ria</strong></div>

<div class="jarzietext">
${m}
</div>
<p><p>
<div class="tituloapp2"><strong>Atributos</strong></div>
<div class="jarzietext"><center><table style="padding: 20px 30px;"><tr>
<td style="padding: 20px 30px;"><div class="subtituloappi">${f.FOR}</div><p><p> FOR </td>

<td style="padding: 20px 30px;"><div class="subtituloappi">${f.DES}</div><p><p> DES </td>

<td style="padding: 20px 30px;"><div class="subtituloappi">${f.PRE}</div><p><p> PRE </td>

<td style="padding: 20px 30px;"><div class="subtituloappi">${f.MEN}</div><p><p> MEN </td>

<td style="padding: 20px 30px;"><div class="subtituloappi">${f.ALM}</div><p><p> ALM </td>
 </tr></table>

<table><tr><td style="padding: 20px 30px;"><div class="subtituloappi">${f.CON}</div><p><p> CON </td>

<td style="padding: 20px 30px;"><div class="subtituloappi">${f.REF}</div><p><p> REF </td>

<td style="padding: 20px 30px;"><div class="subtituloappi">${f.GUA}</div><p><p> GUA </td>

<td style="padding: 20px 30px;"><div class="subtituloappi">${f.AUR}</div><p><p> AUR </td>

<td style="padding: 20px 30px;"><div class="subtituloappi">${f.BIO}</div><p><p> BIO </td>
 </tr></table>

</center></div><p><p>


<div class="tituloapp2"><strong>Habilidades</strong></div>

<div class="jarzietext">
<b>Habilidade de Grupo</b><br>
${n}
</div><p><p>

</div>
</div>
</div>
[/dohtml]`};
